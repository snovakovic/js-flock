!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t=t||self)["js-flock"]={})}(this,function(t){"use strict";var o=Object.freeze({isStrangled:!0,message:"Promise have timed out"});function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t){return!(!t||"object"!==r(t)&&"function"!=typeof t||!Object.prototype.hasOwnProperty.call(t,"constructor")||"function"!=typeof t.constructor||!Function.prototype.toString.call(t.constructor).includes("[native code]"))}function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(e,n,o,t){var i=3<arguments.length&&void 0!==t?t:new Set;if(i.has(n))return n;if(o=o||{},Object[e](n),i.add(n),n===Function.prototype)return n;var r=Object.getOwnPropertyNames(n);if(Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n))),r.forEach(function(t){var r=n[t];!r||"object"!==c(r)&&"function"!=typeof r||"undefined"==typeof ArrayBuffer||ArrayBuffer.isView(r)||"function"==typeof o.exclude&&o.exclude(t,n)||a(e,r,o,i)}),o.proto){var u=Object.getPrototypeOf(n);u&&!f(u)&&a(e,u,o,i)}return n}function n(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var e=function(){function t(){!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),this._calledMaxOnceCount=0}return function(t,r,e){r&&n(t.prototype,r),e&&n(t,e)}(t,[{key:"calledMaxOnce",value:function(t){var r=0<arguments.length&&void 0!==t?t:"Not allowed to be called more than once";if(this._calledMaxOnceCount+=1,1<this._calledMaxOnceCount)throw Error(r)}}]),t}();function i(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(n){return function(t,r){var e=Object.prototype.toString.call(r);if("Function"===t?"function"!=typeof r:"[object ".concat(t,"]")!==e)throw new TypeError("".concat(n,": expected [").concat(t,"] but got ").concat(e))}}function l(n,o){return y("Function",n),function(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];return function(t,r,u){var e=this;return new Promise(function(o,i){r.push(function(t){if(t)return i(t);for(var r=arguments.length,e=new Array(1<r?r-1:0),n=1;n<r;n++)e[n-1]=arguments[n];return o(u&&u.multiArgs?e:e[0])}),t.apply(e,r)})}.call(this,n,r,o)}}var s=function(){function r(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).startFrom;!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r),this._currentNumber=Number(t)||0}return function(t,r,e){r&&i(t.prototype,r),e&&i(t,e)}(r,[{key:"next",value:function(){if(this._currentNumber>=Number.MAX_SAFE_INTEGER)throw Error("Number iterator exhausted");return this._currentNumber++,this._currentNumber}},{key:"current",value:function(){return this._currentNumber}}]),r}(),y=u("promisify"),p=Symbol("promisified");l.all=function(e,n){y("Object",e);var t=n||{},o=t.suffix,i=t.exclude,u=t.include,r=t.proto;if(o="string"==typeof o?o:"Async",i=Array.isArray(i)?i:void 0,u=Array.isArray(u)?u:void 0,Object.getOwnPropertyNames(e).forEach(function(t){if(function(r,t,e){return"function"==typeof r&&!0!==r[p]&&(!e||e.some(function(t){return t===r.name}))&&(!t||t.every(function(t){return t!==r.name}))}(e[t],i,u)){for(var r="".concat(t).concat(o);r in e;){if(!0===e[r][p])return;r="".concat(r,"Promisified")}e[r]=l(e[t],n),e[r][p]=!0}}),r){var c=Object.getPrototypeOf(e);c&&!f(c)&&l.all(c,n)}return e};var m=l,b=u("rerun"),v=u("rerun");function d(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var e=[],n=!0,o=!1,i=void 0;try{for(var u,c=t[Symbol.iterator]();!(n=(u=c.next()).done)&&(e.push(u.value),!r||e.length!==r);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==c.return||c.return()}finally{if(o)throw i}}return e}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function h(t){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,r,e){return r===e?0:r<e?-t:null==r?1:null==e?-1:t}function w(n){return function(t,r,e){return n(r,e)*t}}function S(t,r,e,n,o,i,u){return N(t(i),t(u),r,e,n,o,i,u)}function A(t,r,e,n,o,i,u){return N(i[t],u[t],r,e,n,o,i,u)}function E(t,r,e,n,o,i,u){var c=t.asc||t.desc,f=t.asc?1:-1,a=t.comparer?w(t.comparer):g;if(!c)throw Error("sort: Invalid 'by' sorting configuration.\n      Expecting object with 'asc' or 'desc' key");return j(c)(c,r,e,f,a,i,u)}function O(t,r,e,n){return Array.isArray(r)?(Array.isArray(e)&&e.length<2&&(e=d(e,1)[0]),o=e&&!0!==e?"string"==typeof e?function(t,r,e,n,o){return e(t,n[r],o[r])}.bind(void 0,t,e,n):"function"==typeof e?function(t,r,e,n,o){return e(t,r(n),r(o))}.bind(void 0,t,e,n):j(e[0]).bind(void 0,e.shift(),e,0,t,n):n.bind(void 0,t),r.sort(o)):r;var o}var j=function(t){var r=h(t);return"string"===r?A:"function"===r?S:E},N=function(t,r,e,n,o,i,u,c){return t===r||null==t&&null==r?e.length>n?j(e[n])(e[n],e,n+1,o,i,u,c):0:i(o,t,r)};function x(t){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function P(t,r){var e=t[r];"function"!=typeof e||function(t){return/^class /.test(Function.prototype.toString.call(t))}(e)||(t[r]=e.bind(t))}var F=u("waitFor"),k={castBoolean:function(t){return!0===t||"true"===t},collar:function(t,r){var e=1<arguments.length&&void 0!==r?r:5e3,n=new Promise(function(t,r){setTimeout(r,e,o)});return Promise.race([n,t])},deepFreeze:function(t,r){return a("freeze",t,r)},deepPreventExtensions:function(t,r){return a("preventExtensions",t,r)},deepSeal:function(t,r){return a("seal",t,r)},delay:function(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=Number(r);if(Number.isNaN(t)){var e=Object.prototype.toString.call(r);throw new TypeError("delay: expected [Number] but got ".concat(e))}return new Promise(function(t){setTimeout(t,r)})},empty:function(){for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];return r.forEach(function(t){Array.isArray(t)&&t.splice(0,t.length)}),1===r.length?r[0]:r},Ensurer:e,last:function(t,r){var e=Array.isArray(t)?t.length:0;if(e){if("function"!=typeof r)return t[e-1];for(;--e;)if(r(t[e]))return t[e]}},NumberIterator:s,promiseAll:function(r){if(Array.isArray(r))return Promise.all(r);var n=Object.keys(r),t=n.map(function(t){return r[t]});return Promise.all(t).then(function(t){var e={};return t.forEach(function(t,r){e[n[r]]=t}),e})},promisify:m,rerun:function(t){b("Function",t);var r,e,n,o,i=0;function u(){if(!r&&(!o||o(i))&&(i+=1,!1!==t()))return void setTimeout(u,n);e&&e(i)}return{every:function(t){if(t=Number(t),b("Number",t),!(0<=t))throw Error("rerun: every() need to be called with positive number");return n=t,this},asLongAs:function(t){return b("Function",t),o=t,this},start:function(){if(void 0===n)throw Error("rerun: every() is required before calling start()");return r=!1,u(),this},stop:function(){return r=!0,this},onStop:function(t){return b("Function",t),e=t,this}}},single:function(t,r){v("Array",t);var e=t;if(r&&(v("Function",r),e=e.filter(r)),1<e.length)throw TypeError("More than one element satisfies the condition");if(0===e.length)throw TypeError("No element satisfies the condition");return e[0]},singular:function(n){function o(){return i=!1}var i=!1;return function(){if(!i){i=!0;for(var t=arguments.length,r=new Array(t),e=0;e<t;e++)r[e]=arguments[e];r.unshift(o),n.apply(this,r)}}},sort:function(u){return{asc:function(t){return O(1,u,t,g)},desc:function(t){return O(-1,u,t,g)},by:function(t){if(!Array.isArray(u))return u;var r;if(Array.isArray(t)){if(1===t.length){r=d(t,1)[0]}}else r=t;if(r){var e=r.asc?1:-1,n=r.asc||r.desc,o=r.comparer?w(r.comparer):g;if(!n)throw Error("sort: Invalid 'by' sorting configuration.\n            Expecting object with 'asc' or 'desc' key");return O(e,u,n,o)}var i=E.bind(void 0,t.shift(),t,0,void 0,void 0);return u.sort(i)}}},toEnum:function(t){var r=function(t){if(Array.isArray(t)){var r={};return t.forEach(function(t){r[t]=Symbol(t)}),r}return"object"===x(t)?Object.assign({},t):{}}(t),e=Object.keys(r).filter(function(t){return"function"!=typeof r[t]}),n=e.map(function(t){return r[t]});if(new Set(n).size!==n.length)throw new TypeError("toEnum: Duplicate values detected");Object.freeze(e),Object.freeze(n),Object.keys(r).forEach(function(t){return P(r,t)});var o={keySet:void 0,valueSet:void 0};return r.keys=function(){return e},r.values=function(){return n},r.haveKey=function(t){return o.keySet=o.keySet||new Set(e),o.keySet.has(t)},r.exists=function(t){return o.valueSet=o.valueSet||new Set(n),o.valueSet.has(t)},Object.freeze(r)},waitFor:function(u,t){F("Function",u);var c=Number(t&&t.interval)||50,f=Date.now()+(Number(t&&t.timeout)||5e3);return new Promise(function(e,n){function o(){return i=!0}var i=!1;!function t(){var r=u(o);if(!i)return r?e(r):Date.now()>f?n(new Error("Timed out!")):void setTimeout(t,c)}()})}},T=k.castBoolean,_=k.collar,z=k.deepFreeze,I=k.deepPreventExtensions,M=k.deepSeal,B=k.delay,C=k.empty,D=k.Ensurer,q=k.last,G=k.NumberIterator,K=k.promiseAll,L=k.promisify,R=k.rerun,V=k.single,X=k.singular,H=k.sort,J=k.toEnum,Q=k.waitFor;t.Ensurer=D,t.NumberIterator=G,t.castBoolean=T,t.collar=_,t.deepFreeze=z,t.deepPreventExtensions=I,t.deepSeal=M,t.default=k,t.delay=B,t.empty=C,t.last=q,t.promiseAll=K,t.promisify=L,t.rerun=R,t.single=V,t.singular=X,t.sort=H,t.toEnum=J,t.waitFor=Q,Object.defineProperty(t,"__esModule",{value:!0})});
