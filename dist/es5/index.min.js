!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(t["js-flock"]={})}(this,function(t){"use strict";var r=Object.freeze({isStrangled:!0,message:"Promise have timed out"}),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t){return!(!t||"object"!==(void 0===t?"undefined":n(t))&&"function"!=typeof t||!Object.prototype.hasOwnProperty.call(t,"constructor")||"function"!=typeof t.constructor||!Function.prototype.toString.call(t.constructor).includes("[native code]"))},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function t(r,n,i){var u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(u.has(n))return n;if(i=i||{},Object[r](n),u.add(n),n===Function.prototype)return n;var f=Object.getOwnPropertyNames(n);if(Object.getOwnPropertySymbols&&(f=f.concat(Object.getOwnPropertySymbols(n))),f.forEach(function(e){var f=n[e];!f||"object"!==(void 0===f?"undefined":o(f))&&"function"!=typeof f||"undefined"==typeof ArrayBuffer||ArrayBuffer.isView(f)||"function"==typeof i.exclude&&i.exclude(e,n)||t(r,f,i,u)}),i.proto){var c=Object.getPrototypeOf(n);c&&!e(c)&&t(r,c,i,u)}return n},u=function(t){return function(r,n){var e=Object.prototype.toString.call(n);if("Function"===r?"function"!=typeof n:"[object "+r+"]"!==e)throw new TypeError(t+": expected ["+r+"] but got "+e+"]")}},f=function(t,r){return r={exports:{}},t(r,r.exports),r.exports}(function(t){var r=u("promisify"),n=Symbol("promisified"),o=function(t,r,n){var e=this;return new Promise(function(o,i){r.push(function(t){for(var r=arguments.length,e=Array(r>1?r-1:0),u=1;u<r;u++)e[u-1]=arguments[u];return t?i(t):o(n&&n.multiArgs?e:e[0])}),t.apply(e,r)})},i=function(t,r,e){return"function"==typeof t&&!0!==t[n]&&(!e||e.some(function(r){return r===t.name}))&&(!r||r.every(function(r){return r!==t.name}))},f=function(t,n){return r("Function",t),function(){for(var r=arguments.length,e=Array(r),i=0;i<r;i++)e[i]=arguments[i];return o.call(this,t,e,n)}};f.all=function(t,o){r("Object",t);var u=o||{},c=u.suffix,a=u.exclude,s=u.include,y=u.proto;if(c="string"==typeof c?c:"Async",a=Array.isArray(a)?a:void 0,s=Array.isArray(s)?s:void 0,Object.getOwnPropertyNames(t).forEach(function(r){if(i(t[r],a,s)){for(var e=""+r+c;e in t;){if(!0===t[e][n])return;e+="Promisified"}t[e]=f(t[r],o),t[e][n]=!0}}),y){var l=Object.getPrototypeOf(t);l&&!e(l)&&f.all(l,o)}return t},t.exports=f}),c=u("rerun"),a=function(){function t(t,r){var n=[],e=!0,o=!1,i=void 0;try{for(var u,f=t[Symbol.iterator]();!(e=(u=f.next()).done)&&(n.push(u.value),!r||n.length!==r);e=!0);}catch(t){o=!0,i=t}finally{try{!e&&f.return&&f.return()}finally{if(o)throw i}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return t(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y=function(t,r,n){return r===n?0:r<n?-t:null==r?1:null==n?-1:t},l=function(t,r,n,e){return y(t,n[r],e[r])},p=function(t,r,n,e){return y(t,r(n),r(e))},d=function(t,r,n,e,o,i){return h(t(o),t(i),r,n,e,o,i)},v=function(t,r,n,e,o,i){return h(o[t],i[t],r,n,e,o,i)},b=function(t,r,n,e,o,i){var u=t.asc||t.desc,f=t.asc?1:-1;if(!u)throw Error("sort: Invalid 'by' sorting configuration.\n      Expecting object with 'asc' or 'desc' key");return m(u)(u,r,n,f,o,i)},m=function(t){var r=void 0===t?"undefined":s(t);return"string"===r?v:"function"===r?d:b},h=function(t,r,n,e,o,i,u){return t===r||null==t&&null==r?n.length>e?m(n[e])(n[e],n,e+1,o,i,u):0:y(o,t,r)},S=function(t,r,n){if(!Array.isArray(r))return r;Array.isArray(n)&&n.length<2&&(n=a(n,1)[0]);var e=void 0;return e=n?"string"==typeof n?l.bind(void 0,t,n):"function"==typeof n?p.bind(void 0,t,n):m(n[0]).bind(void 0,n.shift(),n,0,t):y.bind(void 0,t),r.sort(e)},g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w=function(t){if(Array.isArray(t)){var r={};return t.forEach(function(t){r[t]=Symbol(t)}),r}return"object"===(void 0===t?"undefined":g(t))?Object.assign({},t):{}},A=function(t){return/^class /.test(Function.prototype.toString.call(t))},j=function(t,r){var n=t[r];"function"!=typeof n||A(n)||(t[r]=n.bind(t))},O=u("waitFor"),E={collar:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,e=new Promise(function(t,e){return setTimeout(e,n,r)});return Promise.race([e,t])},deepFreeze:function(t,r){return i("freeze",t,r)},deepPreventExtensions:function(t,r){return i("preventExtensions",t,r)},deepSeal:function(t,r){return i("seal",t,r)},empty:function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach(function(t){Array.isArray(t)&&t.splice(0,t.length)}),1===r.length?r[0]:r},last:function(t,r){var n=Array.isArray(t)?t.length:0;if(n){if("function"!=typeof r)return t[n-1];for(;--n;)if(r(t[n]))return t[n]}},promisify:f,rerun:function(t){function r(){e||u&&!u(n)||(n+=1,!1===t())?o&&o(n):setTimeout(r,i)}c("Function",t);var n=0,e=void 0,o=void 0,i=void 0,u=void 0;return{every:function(t){if(t=Number(t),c("Number",t),!(t>=0))throw Error("rerun: every() need to be called with positive number");return i=t,this},asLongAs:function(t){return c("Function",t),u=t,this},start:function(){if(void 0===i)throw Error("rerun: every() is required before calling start()");return e=!1,r(),this},stop:function(){return e=!0,this},onStop:function(t){return c("Function",t),o=t,this}}},singular:function(t){var r=!1,n=function(){return r=!1};return function(){if(!r){r=!0;for(var e=arguments.length,o=Array(e),i=0;i<e;i++)o[i]=arguments[i];o.unshift(n),t.apply(this,o)}}},sort:function(t){return{asc:function(r){return S(1,t,r)},desc:function(r){return S(-1,t,r)},by:function(r){if(!Array.isArray(t))return t;if(!Array.isArray(r))throw Error("sort: Invalid usage of 'by' sorter. Array syntax is required.\n          Did you mean to use 'asc' or 'desc' sorter instead?");if(1===r.length){var n=r[0].asc?1:-1,e=r[0].asc||r[0].desc;if(!e)throw Error("sort: Invalid 'by' sorting configuration.\n            Expecting object with 'asc' or 'desc' key");return S(n,t,e)}var o=b.bind(void 0,r.shift(),r,0,void 0);return t.sort(o)}}},toEnum:function(t){var r=w(t),n=Object.keys(r).filter(function(t){return"function"!=typeof r[t]}),e=n.map(function(t){return r[t]});if(new Set(e).size!==e.length)throw new TypeError("toEnum: Duplicate values detected");Object.freeze(n),Object.freeze(e),Object.keys(r).forEach(function(t){return j(r,t)});var o={keySet:void 0,valueSet:void 0};return r.keys=function(){return n},r.values=function(){return e},r.haveKey=function(t){return o.keySet=o.keySet||new Set(n),o.keySet.has(t)},r.exists=function(t){return o.valueSet=o.valueSet||new Set(e),o.valueSet.has(t)},Object.freeze(r)},waitFor:function(t,r){O("Function",t);var n=Number(r&&r.interval)||50,e=Date.now()+(Number(r&&r.timeout)||5e3);return new Promise(function(r,o){var i=!1,u=function(){return i=!0};!function f(){var c=t(u);if(!i)return c?r(c):Date.now()>e?o(new Error("Timed out!")):void setTimeout(f,n)}()})}},x=E.collar,P=E.deepFreeze,F=E.deepPreventExtensions,k=E.deepSeal,z=E.empty,T=E.last,N=E.promisify,D=E.rerun,I=E.singular,q=E.sort,B=E.toEnum,_=E.waitFor;t.default=E,t.collar=x,t.deepFreeze=P,t.deepPreventExtensions=F,t.deepSeal=k,t.empty=z,t.last=T,t.promisify=N,t.rerun=D,t.singular=I,t.sort=q,t.toEnum=B,t.waitFor=_,Object.defineProperty(t,"__esModule",{value:!0})});
