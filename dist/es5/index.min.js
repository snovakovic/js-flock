!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t=t||self)["js-flock"]={})}(this,function(t){"use strict";var o=Object.freeze({isStrangled:!0,message:"Promise have timed out"});function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function f(t){return!(!t||"object"!==r(t)&&"function"!=typeof t||!Object.prototype.hasOwnProperty.call(t,"constructor")||"function"!=typeof t.constructor||!Function.prototype.toString.call(t.constructor).includes("[native code]"))}function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(n,e,o,t){var i=3<arguments.length&&void 0!==t?t:new Set;if(i.has(e))return e;if(o=o||{},Object[n](e),i.add(e),e===Function.prototype)return e;var r=Object.getOwnPropertyNames(e);if(Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(e))),r.forEach(function(t){var r=e[t];!r||"object"!==c(r)&&"function"!=typeof r||"undefined"==typeof ArrayBuffer||ArrayBuffer.isView(r)||"function"==typeof o.exclude&&o.exclude(t,e)||a(n,r,o,i)}),o.proto){var u=Object.getPrototypeOf(e);u&&!f(u)&&a(n,u,o,i)}return e}function n(e){return function(t,r){var n=Object.prototype.toString.call(r);if("Function"===t?"function"!=typeof r:"[object ".concat(t,"]")!==n)throw new TypeError("".concat(e,": expected [").concat(t,"] but got ").concat(n))}}function s(e,o){return y("Function",e),function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return function(t,r,u){var n=this;return new Promise(function(o,i){r.push(function(t){if(t)return i(t);for(var r=arguments.length,n=new Array(1<r?r-1:0),e=1;e<r;e++)n[e-1]=arguments[e];return o(u&&u.multiArgs?n:n[0])}),t.apply(n,r)})}.call(this,e,r,o)}}var y=n("promisify"),l=Symbol("promisified");s.all=function(n,e){y("Object",n);var t=e||{},o=t.suffix,i=t.exclude,u=t.include,r=t.proto;if(o="string"==typeof o?o:"Async",i=Array.isArray(i)?i:void 0,u=Array.isArray(u)?u:void 0,Object.getOwnPropertyNames(n).forEach(function(t){if(function(r,t,n){return"function"==typeof r&&!0!==r[l]&&(!n||n.some(function(t){return t===r.name}))&&(!t||t.every(function(t){return t!==r.name}))}(n[t],i,u)){for(var r="".concat(t).concat(o);r in n;){if(!0===n[r][l])return;r="".concat(r,"Promisified")}n[r]=s(n[t],e),n[r][l]=!0}}),r){var c=Object.getPrototypeOf(n);c&&!f(c)&&s.all(c,e)}return n};var e=s,p=n("rerun");function i(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var n=[],e=!0,o=!1,i=void 0;try{for(var u,c=t[Symbol.iterator]();!(e=(u=c.next()).done)&&(n.push(u.value),!r||n.length!==r);e=!0);}catch(t){o=!0,i=t}finally{try{e||null==c.return||c.return()}finally{if(o)throw i}}return n}(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,r,n){return r===n?0:r<n?-t:null==r?1:null==n?-1:t}function b(t,r,n,e,o,i){return S(t(o),t(i),r,n,e,o,i)}function d(t,r,n,e,o,i){return S(o[t],i[t],r,n,e,o,i)}function v(t,r,n,e,o,i){var u=t.asc||t.desc,c=t.asc?1:-1;if(!u)throw Error("sort: Invalid 'by' sorting configuration.\n      Expecting object with 'asc' or 'desc' key");return g(u)(u,r,n,c,o,i)}function h(t,r,n){return Array.isArray(r)?(Array.isArray(n)&&n.length<2&&(n=i(n,1)[0]),e=n?"string"==typeof n?function(t,r,n,e){return m(t,n[r],e[r])}.bind(void 0,t,n):"function"==typeof n?function(t,r,n,e){return m(t,r(n),r(e))}.bind(void 0,t,n):g(n[0]).bind(void 0,n.shift(),n,0,t):m.bind(void 0,t),r.sort(e)):r;var e}var g=function(t){var r=u(t);return"string"===r?d:"function"===r?b:v},S=function(t,r,n,e,o,i,u){return t===r||null==t&&null==r?n.length>e?g(n[e])(n[e],n,e+1,o,i,u):0:m(o,t,r)};function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function A(t,r){var n=t[r];"function"!=typeof n||function(t){return/^class /.test(Function.prototype.toString.call(t))}(n)||(t[r]=n.bind(t))}var j=n("waitFor"),O={collar:function(t,r){var n=1<arguments.length&&void 0!==r?r:5e3,e=new Promise(function(t,r){setTimeout(r,n,o)});return Promise.race([e,t])},deepFreeze:function(t,r){return a("freeze",t,r)},deepPreventExtensions:function(t,r){return a("preventExtensions",t,r)},deepSeal:function(t,r){return a("seal",t,r)},delay:function(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=Number(r);if(Number.isNaN(t)){var n=Object.prototype.toString.call(r);throw new TypeError("delay: expected [Number] but got ".concat(n))}return new Promise(function(t){setTimeout(t,r)})},empty:function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return r.forEach(function(t){Array.isArray(t)&&t.splice(0,t.length)}),1===r.length?r[0]:r},last:function(t,r){var n=Array.isArray(t)?t.length:0;if(n){if("function"!=typeof r)return t[n-1];for(;--n;)if(r(t[n]))return t[n]}},promiseAll:function(r){if(Array.isArray(r))return Promise.all(r);var e=Object.keys(r),t=e.map(function(t){return r[t]});return Promise.all(t).then(function(t){var n={};return t.forEach(function(t,r){n[e[r]]=t}),n})},promisify:e,rerun:function(t){p("Function",t);var r,n,e,o,i=0;function u(){if(!r&&(!o||o(i))&&(i+=1,!1!==t()))return void setTimeout(u,e);n&&n(i)}return{every:function(t){if(t=Number(t),p("Number",t),!(0<=t))throw Error("rerun: every() need to be called with positive number");return e=t,this},asLongAs:function(t){return p("Function",t),o=t,this},start:function(){if(void 0===e)throw Error("rerun: every() is required before calling start()");return r=!1,u(),this},stop:function(){return r=!0,this},onStop:function(t){return p("Function",t),n=t,this}}},singular:function(e){function o(){return i=!1}var i=!1;return function(){if(!i){i=!0;for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.unshift(o),e.apply(this,r)}}},sort:function(o){return{asc:function(t){return h(1,o,t)},desc:function(t){return h(-1,o,t)},by:function(t){if(!Array.isArray(o))return o;if(!Array.isArray(t))throw Error("sort: Invalid usage of 'by' sorter. Array syntax is required.\n          Did you mean to use 'asc' or 'desc' sorter instead?");if(1===t.length){var r=t[0].asc?1:-1,n=t[0].asc||t[0].desc;if(!n)throw Error("sort: Invalid 'by' sorting configuration.\n            Expecting object with 'asc' or 'desc' key");return h(r,o,n)}var e=v.bind(void 0,t.shift(),t,0,void 0);return o.sort(e)}}},toEnum:function(t){var r=function(t){if(Array.isArray(t)){var r={};return t.forEach(function(t){r[t]=Symbol(t)}),r}return"object"===w(t)?Object.assign({},t):{}}(t),n=Object.keys(r).filter(function(t){return"function"!=typeof r[t]}),e=n.map(function(t){return r[t]});if(new Set(e).size!==e.length)throw new TypeError("toEnum: Duplicate values detected");Object.freeze(n),Object.freeze(e),Object.keys(r).forEach(function(t){return A(r,t)});var o={keySet:void 0,valueSet:void 0};return r.keys=function(){return n},r.values=function(){return e},r.haveKey=function(t){return o.keySet=o.keySet||new Set(n),o.keySet.has(t)},r.exists=function(t){return o.valueSet=o.valueSet||new Set(e),o.valueSet.has(t)},Object.freeze(r)},waitFor:function(u,t){j("Function",u);var c=Number(t&&t.interval)||50,f=Date.now()+(Number(t&&t.timeout)||5e3);return new Promise(function(n,e){function o(){return i=!0}var i=!1;!function t(){var r=u(o);if(!i)return r?n(r):Date.now()>f?e(new Error("Timed out!")):void setTimeout(t,c)}()})}},E=O.collar,P=O.deepFreeze,x=O.deepPreventExtensions,F=O.deepSeal,k=O.delay,N=O.empty,z=O.last,T=O.promiseAll,D=O.promisify,I=O.rerun,q=O.singular,B=O.sort,_=O.toEnum,K=O.waitFor;t.collar=E,t.deepFreeze=P,t.deepPreventExtensions=x,t.deepSeal=F,t.default=O,t.delay=k,t.empty=N,t.last=z,t.promiseAll=T,t.promisify=D,t.rerun=I,t.singular=q,t.sort=B,t.toEnum=_,t.waitFor=K,Object.defineProperty(t,"__esModule",{value:!0})});
