!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e=e||self)["js-flock"]={})}(this,function(e){"use strict";var o=Object.freeze({isStrangled:!0,message:"Promise have timed out"});function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e){return!(!e||"object"!==r(e)&&"function"!=typeof e||!Object.prototype.hasOwnProperty.call(e,"constructor")||"function"!=typeof e.constructor||!Function.prototype.toString.call(e.constructor).includes("[native code]"))}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(t,n,o,e){var u=3<arguments.length&&void 0!==e?e:new Set;if(u.has(n))return n;if(o=o||{},Object[t](n),u.add(n),n===Function.prototype)return n;var r=Object.getOwnPropertyNames(n);if(Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n))),r.forEach(function(e){var r=n[e];!r||"object"!==c(r)&&"function"!=typeof r||"undefined"==typeof ArrayBuffer||ArrayBuffer.isView(r)||"function"==typeof o.exclude&&o.exclude(e,n)||a(t,r,o,u)}),o.proto){var i=Object.getPrototypeOf(n);i&&!f(i)&&a(t,i,o,u)}return n}function n(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var t=function(){function e(){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,e),this._calledMaxOnceCount=0}return function(e,r,t){r&&n(e.prototype,r),t&&n(e,t)}(e,[{key:"calledMaxOnce",value:function(e){var r=0<arguments.length&&void 0!==e?e:"Not allowed to be called more than once";if(this._calledMaxOnceCount+=1,1<this._calledMaxOnceCount)throw Error(r)}}]),e}();function u(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(n){return function(e,r){var t=Object.prototype.toString.call(r);if("Function"===e?"function"!=typeof r:"[object ".concat(e,"]")!==t)throw new TypeError("".concat(n,": expected [").concat(e,"] but got ").concat(t))}}function l(n,o){return y("Function",n),function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return function(e,r,i){var t=this;return new Promise(function(o,u){r.push(function(e){if(e)return u(e);for(var r=arguments.length,t=new Array(1<r?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];return o(i&&i.multiArgs?t:t[0])}),e.apply(t,r)})}.call(this,n,r,o)}}var s=function(){function r(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).startFrom;!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,r),this._currentNumber=Number(e)||0}return function(e,r,t){r&&u(e.prototype,r),t&&u(e,t)}(r,[{key:"next",value:function(){if(this._currentNumber>=Number.MAX_SAFE_INTEGER)throw Error("Number iterator exhausted");return this._currentNumber++,this._currentNumber}},{key:"current",value:function(){return this._currentNumber}}]),r}(),y=i("promisify"),p=Symbol("promisified");l.all=function(t,n){y("Object",t);var e=n||{},o=e.suffix,u=e.exclude,i=e.include,r=e.proto;if(o="string"==typeof o?o:"Async",u=Array.isArray(u)?u:void 0,i=Array.isArray(i)?i:void 0,Object.getOwnPropertyNames(t).forEach(function(e){if(function(r,e,t){return"function"==typeof r&&!0!==r[p]&&(!t||t.some(function(e){return e===r.name}))&&(!e||e.every(function(e){return e!==r.name}))}(t[e],u,i)){for(var r="".concat(e).concat(o);r in t;){if(!0===t[r][p])return;r="".concat(r,"Promisified")}t[r]=l(t[e],n),t[r][p]=!0}}),r){var c=Object.getPrototypeOf(t);c&&!f(c)&&l.all(c,n)}return t};function b(n){return function(e,r,t){return n(e,r,t)*t}}var m=l,v=i("rerun"),d=i("rerun"),h=function(e,r){if(e)throw Error("Invalid sort config: "+r)},g=function(e){var r=e||{},t=r.asc,n=r.desc,o=t?1:-1,u=t||n;return h(!u,"Expected `asc` or `desc` property"),h(t&&n,"Ambiguous object with `asc` and `desc` config properties"),{order:o,sortBy:u,comparer:e.comparer&&b(e.comparer)}},w=function(y){return function e(r,t,n,o,u,i,c){var f,a;if("string"==typeof r)f=i[r],a=c[r];else{if("function"!=typeof r){var l=g(r);return e(l.sortBy,t,n,l.order,l.comparer||y,i,c)}f=r(i),a=r(c)}var s=u(f,a,o);return(0===s||null==f&&null==a)&&t.length>n?e(t[n],t,n+1,o,u,i,c):s}};function O(e,r,t,n){return Array.isArray(r)?(Array.isArray(t)&&t.length<2&&(t=t[0]),r.sort(function e(t,n,o){if(void 0===t||!0===t)return function(e,r){return n(e,r,o)};if("string"==typeof t)return h(t.includes("."),"String syntax not allowed for nested properties."),function(e,r){return n(e[t],r[t],o)};if("function"==typeof t)return function(e,r){return n(t(e),t(r),o)};if(Array.isArray(t)){var u=w(n);return function(e,r){return u(t[0],t,1,o,n,e,r)}}var r=g(t);return e(r.sortBy,r.comparer||n,r.order)}(t,n,e))):r}function S(e){var t=b(e.comparer);return function(r){return{asc:function(e){return O(1,r,e,t)},desc:function(e){return O(-1,r,e,t)},by:function(e){return O(1,r,e,t)}}}}var j=S({comparer:function(e,r,t){return null==e?t:null==r?-t:e<r?-1:e===r?0:1}});j.createNewInstance=S;var E,A=(E=Object.freeze({__proto__:null,default:j}))&&E.default||E;function P(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})),t.push.apply(t,n)}return t}function N(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function F(e){if(Array.isArray(e)){var r={};return e.forEach(function(e){r[e]=Symbol(e)}),r}return"object"===x(e)?function(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?P(Object(t),!0).forEach(function(e){N(r,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):P(Object(t)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(t,e))})}return r}({},e):{}}function _(e,r){var t=e[r];"function"!=typeof t||function(e){return/^class /.test(Function.prototype.toString.call(e))}(t)||(e[r]=t.bind(e))}var k=i("waitFor"),T={castBoolean:function(e){return!0===e||"true"===e},collar:function(e,r){var t=1<arguments.length&&void 0!==r?r:5e3,n=new Promise(function(e,r){setTimeout(r,t,o)});return Promise.race([n,e])},deepFreeze:function(e,r){return a("freeze",e,r)},deepPreventExtensions:function(e,r){return a("preventExtensions",e,r)},deepSeal:function(e,r){return a("seal",e,r)},delay:function(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=Number(r);if(Number.isNaN(e)){var t=Object.prototype.toString.call(r);throw new TypeError("delay: expected [Number] but got ".concat(t))}return new Promise(function(e){setTimeout(e,r)})},empty:function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.forEach(function(e){Array.isArray(e)&&e.splice(0,e.length)}),1===r.length?r[0]:r},Ensurer:t,last:function(e,r){var t=Array.isArray(e)?e.length:0;if(t){if("function"!=typeof r)return e[t-1];for(;--t;)if(r(e[t]))return e[t]}},NumberIterator:s,promiseAll:function(r){if(Array.isArray(r))return Promise.all(r);var n=Object.keys(r),e=n.map(function(e){return r[e]});return Promise.all(e).then(function(e){var t={};return e.forEach(function(e,r){t[n[r]]=e}),t})},promisify:m,rerun:function(e){v("Function",e);var r,t,n,o,u=0;function i(){if(!r&&(!o||o(u))&&(u+=1,!1!==e()))return void setTimeout(i,n);t&&t(u)}return{every:function(e){if(e=Number(e),v("Number",e),!(0<=e))throw Error("rerun: every() need to be called with positive number");return n=e,this},asLongAs:function(e){return v("Function",e),o=e,this},start:function(){if(void 0===n)throw Error("rerun: every() is required before calling start()");return r=!1,i(),this},stop:function(){return r=!0,this},onStop:function(e){return v("Function",e),t=e,this}}},single:function(e,r){d("Array",e);var t=e;if(r&&(d("Function",r),t=t.filter(r)),1<t.length)throw TypeError("More than one element satisfies the condition");if(0===t.length)throw TypeError("No element satisfies the condition");return t[0]},singular:function(n){function o(){return u=!1}var u=!1;return function(){if(!u){u=!0;for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];r.unshift(o),n.apply(this,r)}}},sort:A,toEnum:function(e){var r=F(e),t=Object.keys(r).filter(function(e){return"function"!=typeof r[e]}),n=t.map(function(e){return r[e]});if(new Set(n).size!==n.length)throw new TypeError("toEnum: Duplicate values detected");Object.freeze(t),Object.freeze(n),Object.keys(r).forEach(function(e){return _(r,e)});var o={keySet:void 0,valueSet:void 0};return r.keys=function(){return t},r.values=function(){return n},r.haveKey=function(e){return o.keySet=o.keySet||new Set(t),o.keySet.has(e)},r.exists=function(e){return o.valueSet=o.valueSet||new Set(n),o.valueSet.has(e)},Object.freeze(r)},waitFor:function(i,e){k("Function",i);var c=Number(e&&e.interval)||50,f=Date.now()+(Number(e&&e.timeout)||5e3);return new Promise(function(t,n){function o(){return u=!0}var u=!1;!function e(){var r=i(o);if(!u)return r?t(r):Date.now()>f?n(new Error("Timed out!")):void setTimeout(e,c)}()})}},z=T.castBoolean,B=T.collar,D=T.deepFreeze,M=T.deepPreventExtensions,I=T.deepSeal,C=T.delay,q=T.empty,G=T.Ensurer,K=T.last,L=T.NumberIterator,R=T.promiseAll,V=T.promisify,X=T.rerun,H=T.single,J=T.singular,Q=T.sort,U=T.toEnum,W=T.waitFor;e.Ensurer=G,e.NumberIterator=L,e.castBoolean=z,e.collar=B,e.deepFreeze=D,e.deepPreventExtensions=M,e.deepSeal=I,e.default=T,e.delay=C,e.empty=q,e.last=K,e.promiseAll=R,e.promisify=V,e.rerun=X,e.single=H,e.singular=J,e.sort=Q,e.toEnum=U,e.waitFor=W,Object.defineProperty(e,"__esModule",{value:!0})});
